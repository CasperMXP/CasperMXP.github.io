<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="java"><title>3.读书笔记《深入理解Java虚拟机》-jvm相关工具 | CHILAM</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">3.读书笔记《深入理解Java虚拟机》-jvm相关工具</h1><a id="logo" href="/.">CHILAM</a><p class="description">Just Do IT</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">3.读书笔记《深入理解Java虚拟机》-jvm相关工具</h1><div class="post-meta">May 14, 2016<span> | </span><span class="category"><a href="/categories/搬砖/">搬砖</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1,298</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 6</span><span class="post-meta-item-text"> Minutes</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Inhalte</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JPS-JVM-Process-Status-Tool"><span class="toc-number">1.</span> <span class="toc-text">JPS(JVM Process Status Tool)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jstat-JVM-Statistics-Monitoring-Tool"><span class="toc-number">2.</span> <span class="toc-text">jstat(JVM Statistics Monitoring Tool)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jinfo-JVM-Configuration-Info-For-Java"><span class="toc-number">3.</span> <span class="toc-text">jinfo(JVM Configuration Info For Java)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jmap-Memory-Map-For-Java"><span class="toc-number">4.</span> <span class="toc-text">jmap(Memory Map For Java)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jhat（JVM-Heap-Analysis-Tool）"><span class="toc-number">5.</span> <span class="toc-text">jhat（JVM Heap Analysis Tool）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jstack-Stack-Trace-For-java"><span class="toc-number">6.</span> <span class="toc-text">jstack(Stack Trace For java)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jconsole"><span class="toc-number">7.</span> <span class="toc-text">jconsole</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jvisualvm"><span class="toc-number">8.</span> <span class="toc-text">jvisualvm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#整合到IDE中"><span class="toc-number">8.1.</span> <span class="toc-text">整合到IDE中</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MemoryAnalyzer"><span class="toc-number">9.</span> <span class="toc-text">MemoryAnalyzer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载与安装"><span class="toc-number">9.1.</span> <span class="toc-text">下载与安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">9.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">9.3.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="JPS-JVM-Process-Status-Tool"><a href="#JPS-JVM-Process-Status-Tool" class="headerlink" title="JPS(JVM Process Status Tool)"></a>JPS(JVM Process Status Tool)</h2><ul>
<li>虚拟机进程状况工具，显示指定系统内所有的HotSpot的虚拟机进程</li>
</ul>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ jps -help</span><br><span class="line">usage: jps [-help]</span><br><span class="line">       jps [-q] [-mlvV] <span class="meta">[&lt;hostid&gt;]</span></span><br><span class="line"></span><br><span class="line">Definitions:</span><br><span class="line">    &lt;hostid&gt;:      &lt;hostname&gt;[:&lt;port&gt;]</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ jps -l</span><br><span class="line"><span class="number">13896</span> org<span class="selector-class">.jetbrains</span><span class="selector-class">.idea</span><span class="selector-class">.maven</span><span class="selector-class">.server</span><span class="selector-class">.RemoteMavenServer</span></span><br><span class="line"><span class="number">1432</span> sun<span class="selector-class">.tools</span><span class="selector-class">.jps</span><span class="selector-class">.Jps</span></span><br><span class="line"><span class="number">4776</span> org<span class="selector-class">.jetbrains</span><span class="selector-class">.jps</span><span class="selector-class">.cmdline</span><span class="selector-class">.Launcher</span></span><br><span class="line"><span class="number">2220</span></span><br></pre></td></tr></table></figure>
<ul>
<li>13896进程ID</li>
<li>org.jetbrains.idea.maven.server.RemoteMavenServer 虚拟机运行的主类</li>
</ul>
<h2 id="jstat-JVM-Statistics-Monitoring-Tool"><a href="#jstat-JVM-Statistics-Monitoring-Tool" class="headerlink" title="jstat(JVM Statistics Monitoring Tool)"></a>jstat(JVM Statistics Monitoring Tool)</h2><ul>
<li>虚拟机统计信息监视工具，收集虚拟机各方面（类装载，内存，垃圾收集，JIT编译）的运行参数</li>
</ul>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -help</span><br><span class="line">Usage: jstat -help|-options</span><br><span class="line">       jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;<span class="built_in">count</span>&gt;]]</span><br><span class="line"></span><br><span class="line">Definitions:</span><br><span class="line">  &lt;option&gt;      An option reported <span class="keyword">by</span> <span class="keyword">the</span> -options option</span><br><span class="line">  &lt;vmid&gt;        Virtual Machine Identifier. A vmid takes <span class="keyword">the</span> following form:</span><br><span class="line">                     &lt;lvmid&gt;[@&lt;hostname&gt;[:&lt;port&gt;]]</span><br><span class="line">                Where &lt;lvmid&gt; <span class="keyword">is</span> <span class="keyword">the</span> <span class="keyword">local</span> vm identifier <span class="keyword">for</span> <span class="keyword">the</span> target</span><br><span class="line">                Java virtual machine, typically a process <span class="built_in">id</span>; &lt;hostname&gt; <span class="keyword">is</span></span><br><span class="line">                <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">of</span> <span class="keyword">the</span> host <span class="built_in">running</span> <span class="keyword">the</span> target Java virtual machine;</span><br><span class="line">                <span class="keyword">and</span> &lt;port&gt; <span class="keyword">is</span> <span class="keyword">the</span> port <span class="built_in">number</span> <span class="keyword">for</span> <span class="keyword">the</span> rmiregistry <span class="keyword">on</span> <span class="keyword">the</span></span><br><span class="line">                target host. See <span class="keyword">the</span> jvmstat documentation <span class="keyword">for</span> a more complete</span><br><span class="line">                description <span class="keyword">of</span> <span class="keyword">the</span> Virtual Machine Identifier.</span><br><span class="line">  &lt;lines&gt;       Number <span class="keyword">of</span> samples <span class="keyword">between</span> header lines.</span><br><span class="line">  &lt;interval&gt;    Sampling interval. The following forms are allowed:</span><br><span class="line">                    &lt;n&gt;[<span class="string">"ms"</span>|<span class="string">"s"</span>]</span><br><span class="line">                Where &lt;n&gt; <span class="keyword">is</span> an <span class="built_in">integer</span> <span class="keyword">and</span> <span class="keyword">the</span> suffix specifies <span class="keyword">the</span> units <span class="keyword">as</span></span><br><span class="line">                milliseconds(<span class="string">"ms"</span>) <span class="keyword">or</span> seconds(<span class="string">"s"</span>). The default units are <span class="string">"ms"</span>.</span><br><span class="line">  &lt;<span class="built_in">count</span>&gt;       Number <span class="keyword">of</span> samples <span class="keyword">to</span> take <span class="keyword">before</span> terminating.</span><br><span class="line">  -J&lt;flag&gt;      Pass &lt;flag&gt; directly <span class="keyword">to</span> <span class="keyword">the</span> runtime system.</span><br></pre></td></tr></table></figure>
<ul>
<li>示例</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -class <span class="number">4776</span></span><br><span class="line">Loaded  Bytes  Unloaded  Bytes     Time</span><br><span class="line">  <span class="number">3025</span>  <span class="number">5676.8</span>        <span class="number">0</span>     <span class="number">0.0</span>       <span class="number">1.61</span></span><br></pre></td></tr></table></figure>
<h2 id="jinfo-JVM-Configuration-Info-For-Java"><a href="#jinfo-JVM-Configuration-Info-For-Java" class="headerlink" title="jinfo(JVM Configuration Info For Java)"></a>jinfo(JVM Configuration Info For Java)</h2><ul>
<li>实时查看和调整虚拟机的各项参数</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ jinfo -flag MaxHeapSize 4776</span><br><span class="line">-XX:<span class="attribute">MaxHeapSize</span>=734003200</span><br></pre></td></tr></table></figure>
<h2 id="jmap-Memory-Map-For-Java"><a href="#jmap-Memory-Map-For-Java" class="headerlink" title="jmap(Memory Map For Java)"></a>jmap(Memory Map For Java)</h2><ul>
<li>生成堆转储快照</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -<span class="keyword">dump</span>:format=b,<span class="keyword">file</span>=F:<span class="comment">//idea.bin 4776</span></span><br><span class="line">Dumping heap to F:\idea.bin ...</span><br><span class="line">Heap <span class="keyword">dump</span> <span class="keyword">file</span> created</span><br></pre></td></tr></table></figure>
<ul>
<li>查看堆信息</li>
</ul>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -heap <span class="number">4776</span></span><br><span class="line">Attaching to process ID <span class="number">4776</span>, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is <span class="number">25.162</span>-b12</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC <span class="keyword">with</span> <span class="number">4</span> thread(s)</span><br><span class="line"></span><br><span class="line">Heap Configuration:</span><br><span class="line">   <span class="attr">MinHeapFreeRatio</span>         = <span class="number">0</span></span><br><span class="line">   <span class="attr">MaxHeapFreeRatio</span>         = <span class="number">100</span></span><br><span class="line">   <span class="attr">MaxHeapSize</span>              = <span class="number">734003200</span> (<span class="number">700.0</span>MB)</span><br><span class="line">   <span class="attr">NewSize</span>                  = <span class="number">65536000</span> (<span class="number">62.5</span>MB)</span><br><span class="line">   <span class="attr">MaxNewSize</span>               = <span class="number">244318208</span> (<span class="number">233.0</span>MB)</span><br><span class="line">   <span class="attr">OldSize</span>                  = <span class="number">131596288</span> (<span class="number">125.5</span>MB)</span><br><span class="line">   <span class="attr">NewRatio</span>                 = <span class="number">2</span></span><br><span class="line">   <span class="attr">SurvivorRatio</span>            = <span class="number">8</span></span><br><span class="line">   <span class="attr">MetaspaceSize</span>            = <span class="number">21807104</span> (<span class="number">20.796875</span>MB)</span><br><span class="line">   <span class="attr">CompressedClassSpaceSize</span> = <span class="number">1073741824</span> (<span class="number">1024.0</span>MB)</span><br><span class="line">   <span class="attr">MaxMetaspaceSize</span>         = <span class="number">17592186044415</span> MB</span><br><span class="line">   <span class="attr">G1HeapRegionSize</span>         = <span class="number">0</span> (<span class="number">0.0</span>MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">PS Young Generation</span><br><span class="line">Eden Space:</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">49807360</span> (<span class="number">47.5</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">28955440</span> (<span class="number">27.614059448242188</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">20851920</span> (<span class="number">19.885940551757812</span>MB)</span><br><span class="line">   <span class="number">58.13486199629934</span>% used</span><br><span class="line">From Space:</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">7864320</span> (<span class="number">7.5</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">5118136</span> (<span class="number">4.881034851074219</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">2746184</span> (<span class="number">2.6189651489257812</span>MB)</span><br><span class="line">   <span class="number">65.08046468098958</span>% used</span><br><span class="line">To Space:</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">7864320</span> (<span class="number">7.5</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">0</span> (<span class="number">0.0</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">7864320</span> (<span class="number">7.5</span>MB)</span><br><span class="line">   <span class="number">0.0</span>% used</span><br><span class="line">PS Old Generation</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">131596288</span> (<span class="number">125.5</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">81936</span> (<span class="number">0.0781402587890625</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">131514352</span> (<span class="number">125.42185974121094</span>MB)</span><br><span class="line">   <span class="number">0.06226315441359562</span>% used</span><br><span class="line"></span><br><span class="line"><span class="number">5133</span> interned Strings occupying <span class="number">444464</span> bytes.</span><br></pre></td></tr></table></figure>
<h2 id="jhat（JVM-Heap-Analysis-Tool）"><a href="#jhat（JVM-Heap-Analysis-Tool）" class="headerlink" title="jhat（JVM Heap Analysis Tool）"></a>jhat（JVM Heap Analysis Tool）</h2><ul>
<li>搭配jmap使用，来分析jmap生成的堆转储文件</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ jhat idea.bin</span><br><span class="line">Reading <span class="keyword">from</span> idea.bin<span class="built_in">..</span>.</span><br><span class="line">Dump file created Tue Jun 19 17:46:12 CST 2018</span><br><span class="line">Snapshot read, resolving<span class="built_in">..</span>.</span><br><span class="line">Resolving 131603 objects<span class="built_in">..</span>.</span><br><span class="line">Chasing references, expect 26 dots<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">Eliminating duplicate references<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">Snapshot resolved.</span><br><span class="line">Started HTTP<span class="built_in"> server </span>on<span class="built_in"> port </span>7000</span><br><span class="line">Server is ready.</span><br></pre></td></tr></table></figure>
<h2 id="jstack-Stack-Trace-For-java"><a href="#jstack-Stack-Trace-For-java" class="headerlink" title="jstack(Stack Trace For java)"></a>jstack(Stack Trace For java)</h2><ul>
<li><p>生成虚拟机当前时刻的线程快照</p>
</li>
<li><p>线程快照就是当前虚拟机内每条线程正在执行的方法堆栈集合</p>
</li>
</ul>
<h2 id="jconsole"><a href="#jconsole" class="headerlink" title="jconsole"></a>jconsole</h2><ul>
<li>java监视与管理控制台</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/41300682.jpg" alt=""></p>
<ul>
<li>选择一个java进程进行分析</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/88285527.jpg" alt=""></p>
<h2 id="jvisualvm"><a href="#jvisualvm" class="headerlink" title="jvisualvm"></a><a href="https://visualvm.github.io/" target="_blank" rel="noopener">jvisualvm</a></h2><ul>
<li>多合一故障处理工具</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/45468579.jpg" alt=""></p>
<ul>
<li>选择一个java进程安装</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/59392183.jpg" alt=""></p>
<h3 id="整合到IDE中"><a href="#整合到IDE中" class="headerlink" title="整合到IDE中"></a><a href="https://visualvm.github.io/idesupport.html" target="_blank" rel="noopener">整合到IDE中</a></h3><ul>
<li><p><a href="https://plugins.jetbrains.com/plugin/7115-visualvm-launcher" target="_blank" rel="noopener">IDEA-VisualVm-Lanucher</a></p>
</li>
<li><p>Idea安装插件</p>
</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/21265987.jpg" alt=""></p>
<ul>
<li>设置本机的jvisualvm.exe</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/71522232.jpg" alt=""></p>
<ul>
<li>运行代码的时候自动回启用该程序的jvisualvm.exe程序</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/2022229.jpg" alt=""></p>
<h2 id="MemoryAnalyzer"><a href="#MemoryAnalyzer" class="headerlink" title="MemoryAnalyzer"></a>MemoryAnalyzer</h2><h3 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h3><ul>
<li><p><a href="http://www.eclipse.org/mat/" target="_blank" rel="noopener">下载地址</a></p>
</li>
<li><p>解压目录如下：</p>
<ul>
<li>MemoryAnalyzer.exe：运行程序</li>
<li>MemoryAnalyzer.ini：运行参数文件</li>
</ul>
</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/58702473.jpg" alt=""></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul>
<li>运行参数设置，一般要分析dump文件较大，所以要设置运行程序的内存-Xmx大小(MemoryAnalyzer.ini)</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-startup</span><br><span class="line">plugins/org<span class="selector-class">.eclipse</span><span class="selector-class">.equinox</span><span class="selector-class">.launcher_1</span>.<span class="number">3.100</span><span class="selector-class">.v20150511-1540</span><span class="selector-class">.jar</span></span><br><span class="line">--launcher.library</span><br><span class="line">plugins/org<span class="selector-class">.eclipse</span><span class="selector-class">.equinox</span><span class="selector-class">.launcher</span><span class="selector-class">.win32</span><span class="selector-class">.win32</span><span class="selector-class">.x86_64_1</span>.<span class="number">1.300</span>.v20150602-<span class="number">1417</span></span><br><span class="line">-vmargs</span><br><span class="line">-Xmx1024m</span><br></pre></td></tr></table></figure>
<ul>
<li>双击MemoryAnalyzer.exe启动界面如下：</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/29855467.jpg" alt=""></p>
<ul>
<li><p>如何获取dump文件</p>
<ul>
<li>-XX:+HeapDumpOnOutOfMemoryError writes heap dump on OutOfMemoryError (recommended)</li>
<li>-XX:+HeapDumpOnCtrlBreak writes heap dump together with thread dump on CTRL+BREAK</li>
<li>Sun (Linux, Solaris; not on Windows) JMap Java 5: jmap -heap:format=b <pid></pid></li>
<li>Sun (Linux, Solaris; Windows see link) JMap Java 6: jmap.exe -dump:format=b,file=HeapDump.hprof <pid></pid></li>
</ul>
</li>
<li><p>选择dump文件</p>
</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/30295703.jpg" alt=""></p>
<ul>
<li>打开dump文件如下</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-19/47927471.jpg" alt=""></p>
<ul>
<li>Leak Suspects 内存泄漏的可疑点</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-20/68978576.jpg" alt=""></p>
<ul>
<li><p>Histogram 每个实例的数量以及占用内存大小，释放后内存你大小</p>
<ul>
<li>Class Name类名称</li>
<li>Objects 实例数量</li>
<li>Shallow Heap 实际内存大小</li>
<li>Retained Heap 回收后释放的内存大小</li>
</ul>
</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-20/32947417.jpg" alt=""></p>
<ul>
<li><p>查看某个对象具体有哪些对象</p>
<ul>
<li>list objects – with outgoing references : 查看这个对象持有的外部对象引用。</li>
<li>list objects – with incoming references : 查看这个对象被哪些外部对象引用。</li>
<li>show objects by class  –  with outgoing references ：查看这个对象类型持有的外部对象引用</li>
<li>show objects by class  –  with incoming references ：查看这个对象类型被哪些外部对象引用</li>
<li>paths to gc root : 显示不同类型引用(上文中提到的Strong ,soft,weak )到跟节点的路径。</li>
<li>java basics:<ul>
<li>classloader 该对象对应的classloader信息</li>
<li>thread details :线程信息</li>
<li>thread stacks  :线程堆栈</li>
<li>find String : 在这个对象中查询需要的字符串（还不确定，需要再搞下）</li>
<li>group by : 根据某个字段统计出现的个数</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-6-20/39096900.jpg" alt=""></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>首先看retained size最大的那些数据，一般看内存都是想解决内存泄漏问题，可以通过Top Consumers或者是donimator tree等actions。</p>
</li>
<li><p>找到最大的数据后，通过list objects – with outgoing references 查看具体持有了哪些对象。</p>
</li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://chilam.me/2016/05/14/jvm-3-tools/" data-id="cjkt0k01l006edl8kicy1zii0" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABuElEQVR42u3aQW6EQAwEwP3/p8k1UgS0bWYWRTWnFYyg2IOF23w+8Tp+rerO5MjDCxcXd8w9Ltf8Bn+vc/b72oCLi7ufW71NcqR3/RsbLi7uK7n52esr4+Li/j9uDq0WPlxc3Pdwk+bnbH9Cz5urx3o1XFzcAffZaKP3e0m+i4uL2+IexXXd2EyOR3fHxcXdws0LSt6u9ApiYbiLi4u7mFstLvOYIz8b/a+4uLjLuNXQ8zq2eGp8cvNGhouLu5FbDS57e3qFEhcXdw83LzTV15e8zCX7cXFx93PzRiVBVEe25egEFxd3Czcfe9w0J8UHzovm6fVxcXEXcCefTE1ilGorhYuL+zZu71upXlG7iUhwcXG3cKvj1YQ4b36ixgwXF3cxNw8+nopQ83J5E5ji4uJu5PaGItfDkvnYFRcX91vcyXClOnTpfdCJi4u7mnsU14qIpBDE4OLibuHmaxRuBuUyGa7g4uLu5Fbbj147lESr0cPg4uJu5CZNTpWVl7lRr4aLi/tibi/+KLdbuLi4r+Tme54KO0avOLi4uAPunshja6+Gi4s74FZLSW/c0hvbjPJdXFzcDvcHm/BxsLc+OB0AAAAASUVORK5CYII=">Aktie</a><div class="tags"><a href="/tags/jvm/">jvm</a></div><div class="post-nav"><a class="pre" href="/2016/05/15/jvm-4-class/">4.读书笔记《深入理解Java虚拟机》-class结构</a><a class="next" href="/2016/05/12/jvm-2-gc/">2.读书笔记《深入理解Java虚拟机》-垃圾收集</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'CasperMXP',
  repo: 'CasperMXP.github.io',
  oauth: {
    client_id: '2cf162fa015e397bb3c9',
    client_secret: '9c97449f4ec96ac4a1064e819e92fde840e66ec7',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/1房2人3餐4季/">1房2人3餐4季</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/搬砖/">搬砖</a><span class="category-list-count">94</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/links/" style="font-size: 15px;">links</a> <a href="/tags/bable/" style="font-size: 15px;">bable</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/design-pattern/" style="font-size: 15px;">design-pattern</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/hibernate/" style="font-size: 15px;">hibernate</a> <a href="/tags/hystrix/" style="font-size: 15px;">hystrix</a> <a href="/tags/Hystrix/" style="font-size: 15px;">Hystrix</a> <a href="/tags/ibatis/" style="font-size: 15px;">ibatis</a> <a href="/tags/idea/" style="font-size: 15px;">idea</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/test/" style="font-size: 15px;">test</a> <a href="/tags/modules/" style="font-size: 15px;">modules</a> <a href="/tags/javaweb/" style="font-size: 15px;">javaweb</a> <a href="/tags/jmm/" style="font-size: 15px;">jmm</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/cache/" style="font-size: 15px;">cache</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/logback/" style="font-size: 15px;">logback</a> <a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/maths/" style="font-size: 15px;">maths</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/spring-boot/" style="font-size: 15px;">spring-boot</a> <a href="/tags/security/" style="font-size: 15px;">security</a> <a href="/tags/sublime/" style="font-size: 15px;">sublime</a> <a href="/tags/javaee/" style="font-size: 15px;">javaee</a> <a href="/tags/weblogic/" style="font-size: 15px;">weblogic</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a> <a href="/tags/win10/" style="font-size: 15px;">win10</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/13/webpack/">webpack</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/13/javascript-modules/">前端模块化</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/react/">react</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/babel/">babel</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/nodejs/">nodejs</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/20/interview-2/">2.面试准备-框架</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/17/links/">1.收藏的一些链接</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/16/life-dinner-noodle/">黑胡椒意面</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/14/interview-1/">1.面试准备-Java</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/04/docker/">1.学习笔记-docker基本概念</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">CHILAM.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.7" zIndex="-1" count="30" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>