<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="java"><title>1.学习笔记-hystrix | CHILAM</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">1.学习笔记-hystrix</h1><a id="logo" href="/.">CHILAM</a><p class="description">Just Do IT</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">1.学习笔记-hystrix</h1><div class="post-meta">May 2, 2017<span> | </span><span class="category"><a href="/categories/搬砖/">搬砖</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1,226</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 4</span><span class="post-meta-item-text"> Minutes</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Inhalte</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#hystrix-产生背景"><span class="toc-number">1.</span> <span class="toc-text">hystrix 产生背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hystrix的实现原理"><span class="toc-number">2.</span> <span class="toc-text">hystrix的实现原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#隔离"><span class="toc-number">2.1.</span> <span class="toc-text">隔离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#熔断-过载保护"><span class="toc-number">2.2.</span> <span class="toc-text">熔断(过载保护)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#降级"><span class="toc-number">2.3.</span> <span class="toc-text">降级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-number">3.</span> <span class="toc-text">使用</span></a></li></ol></div></div><div class="post-content"><h2 id="hystrix-产生背景"><a href="#hystrix-产生背景" class="headerlink" title="hystrix 产生背景"></a>hystrix 产生背景</h2><p>微服务是解决复杂服务的一个方案，在功能不变的情况下，对一个复杂的单体服务分解为多个可管理的分支。每个服务作为轻量的子服务，通过RPC实现服务间的关联，将服务简单化。每个服务根据自己的需要选择技术栈，互不影响，方便开发、维护。例如S划分为a,b,c。微服务的好处是有效的拆分应用，实现敏捷开发和部署。</p>
<p>微服务一系列优势下，也给微服务的管理和稳定性带来挑战，比如一个服务依赖30个微服务，每个微服务的可用性是99.999%，在不加任何管理的情况下，该聚合服务的可用性将是99.999%的30次方=99.97%，系统的可用性直接降了两个数量级达到三个九。<br>且由于依赖的传递性，很容易产生雪崩效应。</p>
<p>一个应用中，任意一个点的不可用或者响应延时都有可能造成服务不可用<br>更可怕的是，被hang住的请求会很快耗尽系统的资源，当该类请求越来越多，占用的计算机资源越来越多的时候，会导致系统瓶颈出现，造成其他的请求同样不可用，最终导致业务系统崩溃，又称：雪崩效应<br>造成雪崩原因可以归结为以下三个：</p>
<ul>
<li>服务提供者不可用（硬件故障，程序Bug，缓存击穿，用户大量请求）</li>
<li>重试加大流量（用户重试，代码逻辑重试）</li>
<li>服务调用者不可用（同步等待造成的资源耗尽）</li>
<li>最终的结果就是一个服务不可用导致一系列服务的不可用，而往往这种后果往往无法预料的。</li>
</ul>
<h2 id="hystrix的实现原理"><a href="#hystrix的实现原理" class="headerlink" title="hystrix的实现原理"></a>hystrix的实现原理</h2><ul>
<li>隔离（线程池隔离和信号量隔离）：限制调用分布式服务的资源使用，某一个调用的服务出现问题不会影响其他服务调用。</li>
<li>优雅的降级机制：超时降级、资源不足时(线程或信号量)降级，降级后可以配合降级接口返回托底数据。</li>
<li>融断：当失败率达到阀值自动触发降级(如因网络故障/超时造成的失败率高)，熔断器触发的快速失败会进行快速恢复。</li>
<li>缓存：提供了请求缓存、请求合并实现。</li>
<li>支持实时监控、报警、控制（修改配置）</li>
</ul>
<h3 id="隔离"><a href="#隔离" class="headerlink" title="隔离"></a>隔离</h3><ul>
<li>线程池隔离模式：使用一个线程池来存储当前的请求，线程池对请求作处理，设置任务返回处理超时时间，堆积的请求堆积入线程池队列。这种方式需要为每个依赖的服务申请线程池，有一定的资源消耗，好处是可以应对突发流量（流量洪峰来临时，处理不完可将数据存储到线程池队里慢慢处理）</li>
<li>信号量隔离模式：使用一个原子计数器（或信号量）来记录当前有多少个线程在运行，请求来先判断计数器的数值，若超过设置的最大线程个数则丢弃改类型的新请求，若不超过则执行计数操作请求来计数器+1，请求返回计数器-1。这种方式是严格的控制线程且立即返回模式，无法应对突发流量（流量洪峰来临时，处理的线程超过数量，其他的请求会直接返回，不继续去请求依赖的服务）</li>
</ul>
<p><img src="http://orkt468tj.bkt.clouddn.com/18-7-6/44277417.jpg" alt=""></p>
<h3 id="熔断-过载保护"><a href="#熔断-过载保护" class="headerlink" title="熔断(过载保护)"></a>熔断(过载保护)</h3><p>正常状态下，电路处于关闭状态(Closed)，如果调用持续出错或者超时，电路被打开进入熔断状态(Open)，后续一段时间内的所有调用都会被拒绝(Fail Fast)，一段时间以后，保护器会尝试进入半熔断状态(Half-Open)，允许少量请求进来尝试，如果调用仍然失败，则回到熔断状态，如果调用成功，则回到电路闭合状态;</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4115139-a4b46af00635f738.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt=""></p>
<h3 id="降级"><a href="#降级" class="headerlink" title="降级"></a>降级</h3><p>根据业务场景的不同，一般采用以下两种模式：</p>
<ul>
<li>第一种（最常用）如果服务失败，则我们通过fallback进行降级，返回静态值。</li>
<li>第二种采用服务级联的模式，如果第一个服务失败，则调用备用服务，例如失败重试或者访问缓存失败再去取数据库。</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ul>
<li>HystrixCommand</li>
<li>HystrixObservableCommand</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CommandHelloWorld</span> <span class="keyword">extends</span> <span class="title">HystrixCommand&lt;String&gt;</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> name;</span><br><span class="line"></span><br><span class="line">    public <span class="type">CommandHelloWorld</span>(<span class="type">String</span> name) &#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="type">HystrixCommandGroupKey</span>.<span class="type">Factory</span>.asKey(<span class="string">"ExampleGroup"</span>));</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">String</span> run() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello "</span> + name + <span class="string">"!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> s = <span class="keyword">new</span> <span class="type">CommandHelloWorld</span>(<span class="string">"Bob"</span>).execute();</span><br><span class="line"><span class="type">Future</span>&lt;<span class="type">String</span>&gt; s = <span class="keyword">new</span> <span class="type">CommandHelloWorld</span>(<span class="string">"Bob"</span>).queue();</span><br><span class="line"><span class="type">Observable</span>&lt;<span class="type">String</span>&gt; s = <span class="keyword">new</span> <span class="type">CommandHelloWorld</span>(<span class="string">"Bob"</span>).observe();</span><br></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://chilam.me/2017/05/02/hystrix-1/" data-id="cjkuf28ko002f598k73odbhkr" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAAByklEQVR42u3aQWrEMAwF0Nz/0lPoaqA0/ZJsTwrPq2ESkucsPral64rH63u8/34f+Z0/r147Bi4u7pj7uh33xN9eeX9P8vzfPgcuLu5Jbh5eydUcnRtwcXGfyU2u3odUMnlcXNz/zs3vSaIQFxf3adzeo/MNTB5ty/ZquLi4A27vwHTt7+3nu7i4uIuqEkmgTEKn/HZcXNwj3B1lkmosJpOJvhAuLu4ibn6QkbRc5IjREgcXF3czt/ro+4JKEkbVY5TClHBxcRdx8wVNL6qqTyu0ZOHi4m7jTpYjvWasXoRFdFxc3EXcvBSa/F8NryTyolni4uJu4ObxtLbokrdl4OLinuRWAyV/dL6xSf7BxcX9LDcJo2Sq1U9QmDwuLu4RbhIok/asXnvHH9sqXFzcbdzkNasOOCaNHbi4uJ/iVosovc1SvpCKljW4uLgbuNVNS3VhdA1GYV2Gi4u7lDtffFRxoyIuLi7uEW41Vqq9EPnxa+/gFRcXdx+31xiRb3WqQRZVfnBxcY9wq0GzqhxbPV7BxcV9GnfUUBWXcqMlDi4u7oO5k5JM8xAEFxf3IHey+ZlEWHV6uLi4Z7iTrUiviJJMeETHxcXtc78A4IJcm5mttxIAAAAASUVORK5CYII=">Aktie</a><div class="tags"><a href="/tags/hystrix/">hystrix</a></div><div class="post-nav"><a class="pre" href="/2017/06/06/hexo-1/">1.hexo使用</a><a class="next" href="/2017/02/15/java-tool/">JDK内置工具</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'CasperMXP',
  repo: 'CasperMXP.github.io',
  oauth: {
    client_id: '2cf162fa015e397bb3c9',
    client_secret: '9c97449f4ec96ac4a1064e819e92fde840e66ec7',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/1房2人3餐4季/">1房2人3餐4季</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/搬砖/">搬砖</a><span class="category-list-count">95</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/cache/" style="font-size: 15px;">cache</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/design-pattern/" style="font-size: 15px;">design-pattern</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/hibernate/" style="font-size: 15px;">hibernate</a> <a href="/tags/hystrix/" style="font-size: 15px;">hystrix</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/ibatis/" style="font-size: 15px;">ibatis</a> <a href="/tags/Hystrix/" style="font-size: 15px;">Hystrix</a> <a href="/tags/idea/" style="font-size: 15px;">idea</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/test/" style="font-size: 15px;">test</a> <a href="/tags/jmm/" style="font-size: 15px;">jmm</a> <a href="/tags/javaweb/" style="font-size: 15px;">javaweb</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/links/" style="font-size: 15px;">links</a> <a href="/tags/bable/" style="font-size: 15px;">bable</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/logback/" style="font-size: 15px;">logback</a> <a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/maths/" style="font-size: 15px;">maths</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/react-router/" style="font-size: 15px;">react-router</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/spring-boot/" style="font-size: 15px;">spring-boot</a> <a href="/tags/sublime/" style="font-size: 15px;">sublime</a> <a href="/tags/security/" style="font-size: 15px;">security</a> <a href="/tags/javaee/" style="font-size: 15px;">javaee</a> <a href="/tags/weblogic/" style="font-size: 15px;">weblogic</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a> <a href="/tags/win10/" style="font-size: 15px;">win10</a> <a href="/tags/modules/" style="font-size: 15px;">modules</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/14/react-router/">react-router</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/13/webpack/">webpack</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/13/javascript-modules/">前端模块化</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/react/">react</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/babel/">babel</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/nodejs/">nodejs</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/20/interview-2/">2.面试准备-框架</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/17/links/">1.收藏的一些链接</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/16/life-dinner-noodle/">黑胡椒意面</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/14/interview-1/">1.面试准备-Java</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">CHILAM.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.7" zIndex="-1" count="30" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>